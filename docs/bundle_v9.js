(()=>{"use strict";var t={},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,n),a.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();class i{constructor(t,e,n,i){this.t="none",this.x=t,this.y=e,this.width=n,this.height=i}read(t=0,e=0,n=this.width,i=this.height){throw new Error("This imgref ("+this.t+") does not support toData")}findSubimage(t,e=0,n=0,i=this.width,a=this.height){return function(t,e,n=0,i=0,a=t.width,r=t.height){if(!t)throw new TypeError;if(!e)throw new TypeError;if(t instanceof o&&d&&alt1.bindFindSubImg){var h=function(t,e=0,n=0,i=t.width,o=t.height){for(var a="",r=n;r<n+o;r++)for(var h=e;h<e+i;h++){var s=4*h+4*t.width*r|0;a+=String.fromCharCode(t.data[s+2|0]),a+=String.fromCharCode(t.data[s+1|0]),a+=String.fromCharCode(t.data[s+0|0]),a+=String.fromCharCode(t.data[s+3|0])}return btoa(a)}(e),s=alt1.bindFindSubImg(t.handle,h,e.width,n,i,a,r);if(!s)throw new l;return JSON.parse(s)}return function(t,e,n=0,i=0,o=t.width,a=t.height){for(var r=[],h=4*e.width,s=4*t.width,l=[],d=0;d<e.height;d++){for(var u=0;u<e.width;u++){var c=4*u+d*h;if(255==e.data[c+3]&&l.push({x:u,y:d}),10==l.length)break}if(10==l.length)break}var g=n+o-e.width,m=i+a-e.height,y=l.length;for(d=i;d<=m;d++)t:for(u=n;u<=g;u++){for(var p=0;p<y;p++){var w=4*(u+l[p].x)+(d+l[p].y)*s,v=4*l[p].x+l[p].y*h,x=0;if(x=(x=(x=x+Math.abs(t.data[w+0]-e.data[v+0])|0)+Math.abs(t.data[w+1]-e.data[v+1])|0)+Math.abs(t.data[w+2]-e.data[v+2])|0,(x*=255/e.data[v+3])>30)continue t}if(f(t,e,u,d,30)!=1/0&&(r.push({x:u,y:d}),r.length>50))return r}return r}(t.read(),e,n,i,a,r)}(this,t,e,n,i,a)}toData(t=this.x,e=this.y,n=this.width,i=this.height){return this.read(t-this.x,e-this.y,n,i)}containsArea(t){return this.x<=t.x&&this.y<=t.y&&this.x+this.width>=t.x+t.width&&this.y+this.height>=t.y+t.height}}class o extends i{constructor(t,e=0,n=0,i=0,o=0){super(e,n,i,o),this.handle=t,this.t="bind"}read(t=0,e=0,n=this.width,i=this.height){return function(t,e,n,i,o){if(e=Math.round(e),n=Math.round(n),i=Math.round(i),o=Math.round(o),c(),alt1.bindGetRegionBuffer)return new a(alt1.bindGetRegionBuffer(t,e,n,i,o),i,o);for(var r=new a(i,o),h=e;;){var s=Math.min(e+i,Math.floor(h+u/4/o)),d=alt1.bindGetRegion(t,h,n,s-h,o);if(!d)throw new l;if(g(d,r,h-e,0,s-h,o),(h=s)==e+i)break}return r}(this.handle,t,e,n,i)}}var a;function r(){try{return n(Object(function(){var t=new Error("Cannot find module 'sharp'");throw t.code="MODULE_NOT_FOUND",t}()))}catch(t){}return null}function h(){r();try{return n(Object(function(){var t=new Error("Cannot find module 'canvas'");throw t.code="MODULE_NOT_FOUND",t}()))}catch(t){}return null}!function(){var t="undefined"!=typeof self?self:void 0!==n.g?n.g:null,e=void 0===t.ImageData||void 0===t.document,i=e;if(!e){t.ImageData;try{let e=new Uint8ClampedArray(4);e[0]=1;let n=new t.ImageData(e,1,1);i=1!=n.data[0]}catch(t){i=!0}}if(i){var o=function(){var t=0,n=arguments[t]instanceof Uint8ClampedArray?arguments[t++]:null,o=arguments[t++],a=arguments[t++];if(e)n||(n=new Uint8ClampedArray(o*a*4)),this.width=o,this.height=a,this.data=n;else if(i){var r=document.createElement("canvas");r.width=o,r.height=a;var h=r.getContext("2d").createImageData(o,a);return n&&h.data.set(n),h}};e||(o.prototype=t.ImageData.prototype),t.ImageData=o,a=o}else a=t.ImageData}(),a.prototype.toDrawableData=function(){return"undefined"==typeof document?function(t){let e=h();if(!e)throw new Error("couldn't find built-in canvas or the module 'canvas'");return new e.ImageData(t.data,t.width,t.height)}(this):this},a.prototype.putImageData=function(t,e,n){for(var i=0;i<t.width;i++)for(var o=0;o<t.height;o++){var a=4*(i+e)+4*(o+n)*this.width,r=4*i+4*o*t.width;this.data[a]=t.data[r],this.data[a+1]=t.data[r+1],this.data[a+2]=t.data[r+2],this.data[a+3]=t.data[r+3]}},a.prototype.pixelOffset=function(t,e){return 4*t+e*this.width*4},a.prototype.getPixelHash=function(t){t||(t=new m(0,0,this.width,this.height));for(var e=0,n=t.x;n<t.x+t.width;n++)for(var i=t.y;i<t.y+t.height;i++){var o=4*n+4*i*this.width;e=((e=((e=((e=(e<<5)-e+this.data[o]|0)<<5)-e+this.data[o+1]|0)<<5)-e+this.data[o+2]|0)<<5)-e+this.data[o+3]|0}return e},a.prototype.clone=function(t){return this.toImage(t).getContext("2d").getImageData(0,0,t.width,t.height)},a.prototype.show=function(t=5,e=5,n=1){if("undefined"!=typeof document){for(var i=document.getElementsByClassName("debugimage");i.length>a.prototype.show.maxImages;)i[0].remove();var o=this.toImage();return o.classList.add("debugimage"),o.style.position="absolute",o.style.zIndex="1000",o.style.left=t/n+"px",o.style.top=e/n+"px",o.style.background="purple",o.style.cursor="pointer",o.style.imageRendering="pixelated",o.style.outline="1px solid #0f0",o.style.width=(1==this.width?100:this.width)*n+"px",o.style.height=(1==this.height?100:this.height)*n+"px",o.onclick=function(){o.remove()},document.body.appendChild(o),o}console.error("need a document to show an imagedata object")},a.prototype.show.maxImages=10,a.prototype.toImage=function(t){if(t||(t=new m(0,0,this.width,this.height)),"undefined"!=typeof document){var e=document.createElement("canvas");e.width=t.width,e.height=t.height}else e=function(t,e){let n=h();if(!n)throw new Error("couldn't find built-in canvas or the module 'canvas'");return n.createCanvas(t,e)}(t.width,t.height);return e.getContext("2d").putImageData(this.toDrawableData(),-t.x,-t.y),e},a.prototype.getPixel=function(t,e){var n=4*t+4*e*this.width;return[this.data[n],this.data[n+1],this.data[n+2],this.data[n+3]]},a.prototype.getPixelValueSum=function(t,e){var n=4*t+4*e*this.width;return this.data[n]+this.data[n+1]+this.data[n+2]},a.prototype.getPixelInt=function(t,e){var n=4*t+4*e*this.width;return(this.data[n+3]<<24)+(this.data[n+0]<<16)+(this.data[n+1]<<8)+(0|this.data[n+2])},a.prototype.getColorDifference=function(t,e,n,i,o,a=255){var r=4*t+4*e*this.width;return Math.abs(this.data[r]-n)+Math.abs(this.data[r+1]-i)+Math.abs(this.data[r+2]-o)*a/255},a.prototype.setPixel=function(t,e,...n){var i,o,a,r,[i,o,a,r]=Array.isArray(n[0])?n[0]:n,h=4*t+4*e*this.width;this.data[h]=i,this.data[h+1]=o,this.data[h+2]=a,this.data[h+3]=null==r?255:r},a.prototype.setPixelInt=function(t,e,n){var i=4*t+4*e*this.width;this.data[i]=n>>24&255,this.data[i+1]=n>>16&255,this.data[i+2]=n>>8&255,this.data[i+3]=255&n},a.prototype.toFileBytes=function(t,e){return"undefined"!=typeof HTMLCanvasElement?new Promise(n=>this.toImage().toBlob(t=>{var e=new FileReader;e.readAsArrayBuffer(t),e.onload=()=>n(new Uint8Array(e.result))},t,e)):function(t,e,i){return o=this,a=void 0,s=function*(){var o,a;if(o=function(){try{return n(Object(function(){var t=new Error("Cannot find module 'electron/common'");throw t.code="MODULE_NOT_FOUND",t}()))}catch(t){}return null}()){let e=o.nativeImage,n=Buffer.from(t.data.slice(t.data.byteOffset,t.data.byteLength));return function(t){for(let e=0;e<t.length;e+=4){let n=t[e+2];t[e+2]=t[e+0],t[e+0]=n}}(n),e.createFromBitmap(n,{width:t.width,height:t.height}).toPNG()}if(a=r()){let n=a(Buffer.from(t.data.buffer),{raw:{width:t.width,height:t.height,channels:4}});if("image/png"==e)n.png();else{if("image/webp"!=e)throw new Error("unknown image format: "+e);var h={quality:80};"number"==typeof i&&(h.quality=100*i),n.webp(h)}return yield n.toBuffer({resolveWithObject:!1}).buffer}throw new Error("coulnd't find build-in image compression methods or the module 'electron/common' or 'sharp'")},new((h=void 0)||(h=Promise))(function(t,e){function n(t){try{r(s.next(t))}catch(t){e(t)}}function i(t){try{r(s.throw(t))}catch(t){e(t)}}function r(e){var o;e.done?t(e.value):(o=e.value,o instanceof h?o:new h(function(t){t(o)})).then(n,i)}r((s=s.apply(o,a||[])).next())});var o,a,h,s}(this,t,e)},a.prototype.toPngBase64=function(){if("undefined"!=typeof HTMLCanvasElement){var t=this.toImage().toDataURL("image/png");return t.slice(t.indexOf(",")+1)}throw new Error("synchronous image conversion not supported in nodejs, try using ImageData.prototype.toFileBytes")},a.prototype.pixelCompare=function(t,e=0,n=0,i){return f(this,t,e,n,i)},a.prototype.copyTo=function(t,e,n,i,o,a,r){const h=0|t.width,s=0|this.width,l=0|i,d=4*Math.floor(i/4),u=new Int32Array(this.data.buffer,this.data.byteOffset,this.data.byteLength/4),c=new Int32Array(t.data.buffer,t.data.byteOffset,t.data.byteLength/4);for(let t=0;t<o;t++){let i=0,o=i+a+(t+r)*h,g=i+e+(t+n)*s;for(;i<d;i+=4)c[o]=u[g],c[o+1]=u[g+1],c[o+2]=u[g+2],c[o+3]=u[g+3],o+=4,g+=4;for(;i<l;i++)c[o]=u[g],o+=1,g+=1}},"undefined"!=typeof HTMLImageElement&&(HTMLImageElement.prototype.toBuffer=function(t=0,e=0,n=this.width,i=this.height){var o=document.createElement("canvas");o.width=n,o.height=i;var a=o.getContext("2d");return a.drawImage(this,-t,-e),a.getImageData(0,0,n,i)},HTMLImageElement.prototype.toCanvas=function(t=0,e=0,n=this.width,i=this.height){var o=document.createElement("canvas");return o.width=n,o.height=i,o.getContext("2d").drawImage(this,-t,-e),o});class s extends Error{constructor(){super(),this.message="This method can not be ran outside of Alt1"}}class l extends Error{}var d="undefined"!=typeof alt1,u=(d&&alt1.skinName,4e6);function c(){if(!d)throw new s}function g(t,e,n,i,o,a){var r=atob(t),h=e.data;o|=0,a|=0;for(var s=4*n+4*i*e.width,l=0|e.width,d=0;d<o;d++)for(var u=0;u<a;u++){var c=s+(4*d|0)+(u*l*4|0)|0,g=(4*d|0)+(4*u*o|0)|0;h[c+0|0]=r.charCodeAt(g+2|0),h[c+1|0]=r.charCodeAt(g+1|0),h[c+2|0]=r.charCodeAt(g+0|0),h[c+3|0]=r.charCodeAt(g+3|0)}return e}function f(t,e,n,i,o=30){if(n<0||i<0)throw new RangeError;if(n+e.width>t.width||i+e.height>t.height)throw new RangeError;-1==o&&(o=1020);for(var a=0,r=8;r>=1;r/=2)for(var h=0;h<e.width;h+=r)for(var s=0;s<e.height;s+=r){var l=4*(n+h)+(i+s)*t.width*4,d=4*h+s*e.width*4,u=0;if(u=(u=(u=u+Math.abs(t.data[l+0]-e.data[d+0])|0)+Math.abs(t.data[l+1]-e.data[d+1])|0)+Math.abs(t.data[l+2]-e.data[d+2])|0,u*=e.data[d+3]/255,1==r&&(a+=u),u>o)return 1/0}return a/e.width/e.height}class m{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}static fromArgs(...t){if("object"==typeof t[0])return new m(t[0].x,t[0].y,t[0].width,t[0].height);if("number"==typeof t[0]&&t.length>=4)return new m(t[0],t[1],t[2],t[3]);throw new Error("invalid rect args")}union(t){var e=Math.min(this.x,t.x),n=Math.min(this.y,t.y);return this.width=Math.max(this.x+this.width,t.x+t.width)-e,this.height=Math.max(this.y+this.height,t.y+t.height)-n,this.x=e,this.y=n,this}includePoint(t,e){this.union(new m(t,e,0,0))}inflate(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}intersect(t){this.x<t.x&&(this.width-=t.x-this.x,this.x=t.x),this.y<t.y&&(this.height-=t.y-this.y,this.y=t.y),this.width=Math.min(this.x+this.width,t.x+t.width)-this.x,this.height=Math.min(this.y+this.height,t.y+t.height)-this.y,(this.width<=0||this.height<=0)&&(this.width=0,this.height=0)}overlaps(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}contains(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height}containsPoint(t,e){return this.x<=t&&this.x+this.width>t&&this.y<=e&&this.y+this.height>e}}function y(t){return null}function p(t){const e=t.width,n=t.height;if(e<6||n<6)return!1;const i=Math.floor(.2*e),o=Math.floor(.8*e),a=Math.floor(.2*n),r=Math.floor(.8*n),h=Math.max(1,o-i),s=Math.max(1,r-a),l=t.data;let d=0,u=0,c=0;for(let t=0;t<10;t++)for(let o=0;o<10;o++){const r=Math.min(e-1,i+Math.floor((o+.5)*h/10)),g=4*(Math.min(n-1,a+Math.floor((t+.5)*s/10))*e+r),f=l[g],m=l[g+1],y=l[g+2],p=.299*f+.587*m+.114*y;d+=p,u+=p*p,c+=Math.max(f,m,y)-Math.min(f,m,y)}const g=d/100,f=Math.max(0,u/100-g*g);return Math.sqrt(f)>=8||c/100>=10}function w(t){const e=t.width,n=t.height,i=t.data,o=Math.floor(.35*e),a=Math.floor(.95*e),r=Math.floor(.35*n),h=Math.floor(.95*n),s=Math.max(1,a-o),l=Math.max(1,h-r),d=new Array(64);let u=0;for(let t=0;t<8;t++)for(let a=0;a<8;a++){const h=Math.min(e-1,o+Math.floor((a+.5)*s/8)),c=4*(Math.min(n-1,r+Math.floor((t+.5)*l/8))*e+h),g=.299*i[c]+.587*i[c+1]+.114*i[c+2];d[8*t+a]=g,u+=g}const c=u/d.length;let g="";for(let t=0;t<d.length;t++)g+=d[t]>=c?"1":"0";let f="";for(let t=0;t<64;t+=4)f+=parseInt(g.slice(t,t+4),2).toString(16);return f}function v(t,e,n,i,o){const a=Math.max(0,Math.min(t.width-1,Math.floor(e))),r=Math.max(0,Math.min(t.height-1,Math.floor(n))),h=Math.max(0,Math.min(t.width,Math.floor(a+i))),s=Math.max(0,Math.min(t.height,Math.floor(r+o))),l=Math.max(1,h-a),d=Math.max(1,s-r),u=new ImageData(l,d),c=t.data,g=u.data,f=4*t.width,m=4*l;for(let t=0;t<d;t++){const e=(r+t)*f+4*a,n=t*m;g.set(c.subarray(e,e+m),n)}return u}function x(t){const e=t.width,n=t.height,i=Math.floor(.22*e),o=Math.floor(.22*n);return v(t,i,o,Math.max(1,e-i),Math.max(1,n-o))}class b{constructor(t){this.runState="idle",this.slots=Array.from({length:28},()=>({sig:null,qty:null,pendingSig:null,pendingCount:0})),this.loot={},this.iconImgs=new Map,this.timer=null,this.updateCb=null,this.state=t,this.invRegion=t.settings.invRegion??null,this.moneyRegion=t.settings.moneyRegion??null}onUpdate(t){this.updateCb=t}hasInventoryRegion(){return!!this.invRegion}hasMoneyRegion(){return!!this.moneyRegion}getRunState(){return this.runState}getDiagLine(){const t=window.alt1;return t?`alt1 ok | pixel=${!!t.permissionPixel} overlay=${!!t.permissionOverlay} rsLinked=${!!t.rsLinked}`:"alt1: not detected"}getCurrentLoot(){return Object.values(this.loot).sort((t,e)=>e.qty-t.qty)}getIconImageData(t){return this.iconImgs.get(t)??null}reset(){this.loot={},this.iconImgs.clear(),this.slots=this.slots.map(()=>({sig:null,qty:null,pendingSig:null,pendingCount:0}))}setInventoryRegion(t){this.invRegion=t,this.state.settings.invRegion=t,this.updateCb?.()}setMoneyRegion(t){this.moneyRegion=t,this.state.settings.moneyRegion=t,this.updateCb?.()}captureFullImageData(){const t=function(t,e,n,i){t=Math.round(t),e=Math.round(e),n=Math.round(n),i=Math.round(i),c();var a=alt1.bindRegion(t,e,n,i);if(a<=0)throw new l("capturehold failed");return new o(a,t,e,n,i)}(0,0,alt1.rsWidth,alt1.rsHeight);if(!t)return{img:null,error:"captureHoldFullRs() returned null"};const e=function(t){if("undefined"!=typeof ImageData&&t instanceof ImageData)return t;try{if("function"==typeof t?.toData)return t.toData()}catch{}try{if("function"==typeof t?.getData)return t.getData()}catch{}try{if("function"==typeof t?.read){const e=t.width??t.w,n=t.height??t.h;if("number"==typeof e&&"number"==typeof n)return t.read(0,0,e,n)}}catch{}try{if("function"==typeof t?.read)return t.read()}catch{}return null}(t);return e?{img:e,error:null}:{img:null,error:"Could not convert capture to ImageData"}}previewRegionImageData(t,e){const n=this.captureFullImageData();return n.error||!n.img?{img:null,error:n.error}:{img:v(n.img,e.x,e.y,e.w,e.h),error:null}}start(t){this.invRegion&&(this.runState="running",this.reset(),this.captureAndUpdate(!0),this.timer&&window.clearInterval(this.timer),this.timer=window.setInterval(()=>{"running"===this.runState&&this.captureAndUpdate(!1)},650),this.state.activeSession={id:crypto.randomUUID(),label:t,startedAt:Date.now(),endedAt:null,loot:[]},this.updateCb?.())}togglePause(){"idle"!==this.runState&&(this.runState="paused"===this.runState?"running":"paused",this.updateCb?.())}stop(){if("idle"===this.runState)return;this.runState="idle",this.timer&&(window.clearInterval(this.timer),this.timer=null);const t=this.state.activeSession;t&&(t.endedAt=Date.now(),t.loot=this.getCurrentLoot(),this.state.sessions.unshift(t),this.state.activeSession=null),this.updateCb?.()}captureAndUpdate(t){if(!this.invRegion)return;const e=this.captureFullImageData();if(e.error||!e.img)return;const n=e.img,i=Math.floor(this.invRegion.w/4),o=Math.floor(this.invRegion.h/7);for(let e=0;e<28;e++){const a=e%4,r=Math.floor(e/4),h=this.invRegion.x+a*i,s=this.invRegion.y+r*o,l=v(n,h+Math.floor(.18*i),s+Math.floor(.26*o),Math.floor(.64*i),Math.floor(.64*o));if(v(n,h+1,s+1,Math.floor(.7*i),Math.floor(.38*o)),!p(l)){this.applySlotUpdate(e,null,null,t,null);continue}const d=x(l),u=w(d),c=y();this.applySlotUpdate(e,u,c,t,d)}if(!t&&this.moneyRegion){v(n,this.moneyRegion.x,this.moneyRegion.y,this.moneyRegion.w,this.moneyRegion.h);const t=null;t&&this.addLoot("coins:pouch","Coins (Money Pouch)",t,null)}this.updateCb?.()}applySlotUpdate(t,e,n,i,o){const a=this.slots[t];if(i)return a.sig=e,a.qty=n,a.pendingSig=null,void(a.pendingCount=0);if(!e)return a.sig=null,a.qty=null,a.pendingSig=null,void(a.pendingCount=0);if(a.pendingSig!==e)return a.pendingSig=e,void(a.pendingCount=1);if(a.pendingCount++,a.pendingCount<2)return;a.pendingSig=null,a.pendingCount=0;const r=a.sig,h=a.qty;a.sig=e,a.qty=n,o&&!this.iconImgs.has(e)&&this.iconImgs.set(e,o),null!==n?r===e&&null!==h?n>h&&this.addLoot(e,this.displayName(e),n-h,o):this.addLoot(e,this.displayName(e),n,o):r!==e&&this.addLoot(e,this.displayName(e),1,o)}addLoot(t,e,n,i){n<=0||(this.loot[t]||(this.loot[t]={key:t,name:e,qty:0,iconSig:t}),this.loot[t].qty+=n,i&&!this.iconImgs.has(t)&&this.iconImgs.set(t,i),this.state.activeSession&&(this.state.activeSession.loot=this.getCurrentLoot()))}displayName(t){return this.state.iconNames[t]??`Unidentified (${t.slice(0,6)})`}}const M="alt1_loot_tracker_state_v1";function C(t,e){const n=document.getElementById(t);n&&(n.textContent=e)}function I(t){const e=document.getElementById(t);if(!e)throw new Error(`Missing element #${t}`);return e}function S(t){C("lastAction",`last: ${t}`),console.log("[LootTracker]",t)}function R(t,e){t.width=e.width,t.height=e.height;const n=t.getContext("2d");if(!n)throw new Error("No 2D context");n.putImageData(e,0,0)}function D(t,e,n){if(R(t,e),!n)return;const i=t.getContext("2d");i&&(i.save(),i.lineWidth=3,i.strokeStyle="rgba(255, 255, 0, 0.95)",i.fillStyle="rgba(255, 255, 0, 0.12)",i.fillRect(n.x,n.y,n.w,n.h),i.strokeRect(n.x,n.y,n.w,n.h),i.restore())}window.addEventListener("load",()=>{S("window load");const t=function(){const t=localStorage.getItem(M);if(t)try{const e=JSON.parse(t);return{settings:{invRegion:e.settings?.invRegion??null,moneyRegion:e.settings?.moneyRegion??null},iconNames:e.iconNames??{},sessions:e.sessions??[],activeSession:null}}catch{}return{settings:{invRegion:null,moneyRegion:null},iconNames:{},sessions:[],activeSession:null}}(),e=new b(t),n=I("modePill"),i=I("cnvFull"),o=I("cnvInv"),a=I("cnvMoney"),r=I("sessionLabel");let h="inv",s=null,l=!1,d=null,u=null;function c(t){h=t,n.textContent="mode: "+("inv"===t?"inventory":"money")}function g(t,e){I(t+"X").value=String(e.x),I(t+"Y").value=String(e.y),I(t+"W").value=String(e.w),I(t+"H").value=String(e.h)}function f(t){const e={x:I(t+"X").value,y:I(t+"Y").value,w:I(t+"W").value,h:I(t+"H").value},n=[];if(e.x.trim()||n.push(t+"X"),e.y.trim()||n.push(t+"Y"),e.w.trim()||n.push(t+"W"),e.h.trim()||n.push(t+"H"),n.length)return{rect:null,why:`Missing: ${n.join(", ")}`};const i=Number(e.x),o=Number(e.y),a=Number(e.w),r=Number(e.h);return[i,o,a,r].every(Number.isFinite)?a<=0||r<=0?{rect:null,why:"w/h must be > 0"}:{rect:{x:i,y:o,w:a,h:r},why:null}:{rect:null,why:"Values must be numbers"}}function m(n){C("statusInv",e.hasInventoryRegion()?"Inventory: set":"Inventory: not set"),C("statusMoney",e.hasMoneyRegion()?"Money: set":"Money: not set"),C("statusRun",`Status: ${e.getRunState()}`);const i=e.getDiagLine();C("diag",n?`${i} | ${n}`:i);const o=I("btnStart"),a=I("btnPause"),r=I("btnStop");o.disabled="idle"!==e.getRunState(),a.disabled="idle"===e.getRunState(),r.disabled="idle"===e.getRunState(),function(t,e,n){const i=document.getElementById("lootRows");if(i){i.innerHTML="";for(const e of t){const t=document.createElement("tr"),o=document.createElement("td");o.style.width="42px";const a=document.createElement("canvas");a.width=32,a.height=32,a.style.width="32px",a.style.height="32px",a.style.borderRadius="6px",a.style.border="1px solid #222635",a.style.background="#0b0c10",a.style.imageRendering="pixelated",o.appendChild(a);const r=n?n(e.key):null;if(r)try{a.width=r.width,a.height=r.height;const t=a.getContext("2d");t&&t.putImageData(r,0,0)}catch{}const h=document.createElement("td");h.textContent=e.name;const s=document.createElement("td");s.textContent=String(e.qty),s.style.textAlign="right",t.appendChild(o),t.appendChild(h),t.appendChild(s),i.appendChild(t)}}}(e.getCurrentLoot(),0,t=>e.getIconImageData(t)),function(t){const e=document.getElementById("sessionRows");if(e){e.innerHTML="";for(const n of t){const t=document.createElement("tr"),i=document.createElement("td");i.textContent=new Date(n.startedAt).toLocaleString();const o=document.createElement("td");o.textContent=n.label;const a=document.createElement("td");a.style.textAlign="right",a.textContent=String(n.loot?.length??0),t.appendChild(i),t.appendChild(o),t.appendChild(a),e.appendChild(t)}}}(t.sessions),function(t){localStorage.setItem(M,JSON.stringify({settings:t.settings,iconNames:t.iconNames,sessions:t.sessions}))}(t)}function y(t){const e=i.getBoundingClientRect(),n=i.width/e.width,o=i.height/e.height;return{x:Math.max(0,Math.min(i.width-1,Math.floor((t.clientX-e.left)*n))),y:Math.max(0,Math.min(i.height-1,Math.floor((t.clientY-e.top)*o)))}}I("btnModeInv").onclick=()=>{S("mode: inv"),c("inv"),m()},I("btnModeMoney").onclick=()=>{S("mode: money"),c("money"),m()},c("inv"),I("btnCaptureFull").onclick=()=>{S("clicked: capture full");const t=e.captureFullImageData();if(t.error||!t.img)return m(`capture: ${t.error}`);s=t.img,u=null,R(i,s),I("btnSaveSelection").disabled=!0,I("btnClearSelection").disabled=!0,m("capture ok")},i.addEventListener("mousedown",t=>{s&&(l=!0,d=y(t),u={x:d.x,y:d.y,w:1,h:1},D(i,s,u),m("draggingâ€¦"))}),i.addEventListener("mousemove",t=>{if(!s||!l||!d)return;const e=y(t),n=Math.min(d.x,e.x),o=Math.min(d.y,e.y),a=Math.max(d.x,e.x),r=Math.max(d.y,e.y);u={x:n,y:o,w:Math.max(1,a-n),h:Math.max(1,r-o)},D(i,s,u)}),i.addEventListener("mouseup",()=>{if(s){if(l=!1,d=null,!u||u.w<5||u.h<5)return u=null,R(i,s),I("btnSaveSelection").disabled=!0,I("btnClearSelection").disabled=!0,m("selection cleared");I("btnSaveSelection").disabled=!1,I("btnClearSelection").disabled=!1,m(`selection ready ${u.w}x${u.h}`)}}),I("btnClearSelection").onclick=()=>{S("clicked: clear selection"),s&&(u=null,R(i,s),I("btnSaveSelection").disabled=!0,I("btnClearSelection").disabled=!0,m("selection cleared"))},I("btnSaveSelection").onclick=()=>{if(S("clicked: save selection"),!u)return m("no selection");"inv"===h?(e.setInventoryRegion(u),g("inv",u),m("saved inv region")):(e.setMoneyRegion(u),g("mon",u),m("saved money region"))},I("btnSetInv").onclick=()=>{S("clicked: set inv");const t=f("inv");if(!t.rect)return m(`inv set: ${t.why}`);e.setInventoryRegion(t.rect),m("inv set")},I("btnPreviewInv").onclick=()=>{S("clicked: preview inv");const t=f("inv");if(!t.rect)return m(`inv preview: ${t.why}`);const n=e.previewRegionImageData("inv",t.rect);if(n.error||!n.img)return m(`inv preview: ${n.error}`);R(o,n.img),m("inv preview ok")},I("btnSetMoney").onclick=()=>{S("clicked: set money");const t=f("mon");if(!t.rect)return m(`money set: ${t.why}`);e.setMoneyRegion(t.rect),m("money set")},I("btnPreviewMoney").onclick=()=>{S("clicked: preview money");const t=f("mon");if(!t.rect)return m(`money preview: ${t.why}`);const n=e.previewRegionImageData("money",t.rect);if(n.error||!n.img)return m(`money preview: ${n.error}`);R(a,n.img),m("money preview ok")},I("btnStart").onclick=()=>{S("clicked: start"),e.start(r.value.trim()||"Unnamed"),m("started")},I("btnPause").onclick=()=>{S("clicked: pause"),e.togglePause(),m("pause toggled")},I("btnStop").onclick=()=>{S("clicked: stop"),e.stop(),m("stopped")},I("btnClearAll").onclick=()=>{S("clicked: clear all"),t.sessions=[],t.iconNames={},e.reset(),t.settings.invRegion=null,t.settings.moneyRegion=null,m("cleared")},e.onUpdate(()=>m()),m("boot ok")})})();
//# sourceMappingURL=bundle.js.map